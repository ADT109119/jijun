# 輕鬆記帳 2.0 - 現代化 PWA

這是「輕鬆記帳」應用程式的現代化版本，採用最新的前端技術重新打造，旨在提供更美觀、更易用、更穩健的記帳體驗。

## 🚀 新功能特色與 UI/UX 改進

### ✨ 全新設計與視覺效果
- **現代化 UI**: 採用 Tailwind CSS 打造的簡潔美觀介面，並使用漸層背景增添視覺層次。
- **響應式設計**: 完美適配手機、平板和桌面裝置，確保在不同裝置上都有一致且良好的視覺體驗。
- **流暢動畫**: 豐富的互動動畫提升使用體驗，例如分類按鈕的選中效果、滑動切換頁面等。
- **圖標顯示與顏色**: 整合 Font Awesome 6，所有圖標風格統一且清晰。分類按鈕支援自定義顏色，並有明確的選中狀態視覺回饋。

### 📊 強化功能
- **資料視覺化**: 使用 Chart.js 提供圓餅圖（支出分類）和水位圖（預算管理），讓使用者能直觀地分析收支狀況。
- **智能統計**: 多維度收支分析和分類統計，首頁快速統計功能移至最上方，方便用戶快速概覽。
- **記錄管理**: 完整的增刪改查功能，記錄明細間距修復，同日記錄顯示更清晰。
- **每月預算設定**: 可設定每月支出預算，水位圖動態顯示預算使用情況，並有超支警告。
- **自定義分類**: 完整的分類管理功能，可新增自定義分類、選擇圖示和顏色，並與預設分類無縫整合。
- **時間範圍選擇**: 首頁可切換查看本週/本月資料，動態更新統計數字和圓餅圖。
- **滑動手勢功能**: 首頁支援左右滑動切換支出分類和預算管理，實時跟隨手指移動，同時支援標籤點擊和圓點指示器。
- **資料匯出入**: 支援完整的資料匯出和匯入功能，向下相容舊版資料格式，提供安全的資料備份和遷移。
- **PWA 更新機制**: 智能版本控制和自動更新提示，解決 PWA 快取問題，確保用戶始終使用最新版本。

### 🧭 導覽系統
- **底部導覽列**: 統一的底部導覽列，包含「首頁 (🏠)」、「記帳 (➕)」、「統計 (📊)」，方便在各頁面間快速切換。
- **導覽圖標**: 導覽列圖標已更新為 Font Awesome 圖標，更易識別且風格統一。

## 🛠️ 技術升級與開發環境

### 核心技術棧
- **前端框架**: 原生 HTML/CSS/JS，無任何框架。
- **CSS 框架**: Tailwind CSS，提供原子化的 class，客製化彈性高。
- **圖表庫**: Chart.js，用於資料視覺化。
- **圖標庫**: Font Awesome 6。
- **資料儲存**: 從 `localStorage` 升級到 `IndexedDB`，提供更強大的非同步儲存和查詢能力。

### 開發工具
- **建置工具**: Vite，提供快速的開發伺服器和建置功能。
- **程式碼品質**: ESLint 進行程式碼檢查。
- **程式碼格式化**: Prettier 統一程式碼風格。

### 專案結構
```
輕鬆記帳/
├── src/                    # 源碼目錄
│   ├── js/                # JavaScript 模組
│   │   ├── main.js        # 主應用程式
│   │   ├── dataService.js # 資料服務
│   │   ├── categories.js  # 分類配置
│   │   ├── statistics.js  # 統計圖表
│   │   ├── recordsList.js # 記錄列表
│   │   ├── budgetManager.js # 預算管理模組
│   │   ├── categoryManager.js # 自定義分類管理模組
│   │   └── utils.js       # 工具函數
│   ├── css/               # 樣式檔案
│   │   └── main.css       # 主樣式
│   └── index.html         # 開發用 HTML
├── public/                # 公共資源
│   ├── manifest.json      # PWA 配置
│   └── serviceWorker.js   # Service Worker
├── icon/                  # 圖示檔案
├── package.json           # 專案配置
├── vite.config.js         # Vite 配置
└── index.html             # 入口檔案
```

### 開發環境設置
1.  **安裝依賴**:
    ```bash
    npm install
    ```
2.  **開發模式**:
    ```bash
    npm run dev
    ```
    這會啟動 Vite 開發伺服器，通常在 `http://localhost:3000`。
3.  **建置生產版本**:
    ```bash
    npm run build
    ```
4.  **預覽生產版本**:
    ```bash
    npm run preview
    ```
5.  **程式碼檢查**:
    ```bash
    npm run lint
    ```
6.  **程式碼格式化**:
    ```bash
    npm run format
    ```

## 🔄 資料遷移

新版本會自動檢測並遷移舊版本的資料：
1.  檢測 `localStorage` 中的 `AllTheData`。
2.  自動轉換格式並匯入 `IndexedDB`。
3.  備份原始資料為 `AllTheData_backup`。
4.  清除舊的 `localStorage` 資料。

## 🔧 問題排除與修復

### 已修復的問題
-   `getDateRange is not defined` 錯誤：已在 `main.js` 中正確導入 `getDateRange`。
-   `Cannot read properties of null (reading 'classList')` 錯誤：在所有 DOM 操作前添加存在性檢查。
-   IndexedDB 相容性問題：添加了 `localStorage` 備用機制。
-   圖表重複渲染問題：添加圖表實例管理，渲染前先銷毀舊圖表。
-   圖標顯示問題：在所有相關位置將圖標顯示從 `${categoryIcon}` 改為 `<i class="${categoryIcon}"></i>`。
-   分類按鈕樣式問題：使用內聯樣式強制覆蓋，確保樣式生效。

### 測試方法
1.  **重新載入頁面**: `npm run dev`
2.  **檢查控制台**: 確保沒有錯誤訊息。
3.  **功能測試**:
    -   首頁正常載入（無控制台錯誤），預算水位圖、支出甜甜圈圖、最近記錄列表顯示正常。
    -   導覽列正常切換。
    -   記帳功能正常，自定義分類功能正常。

### 常見問題
-   **首頁圖表不顯示？** 確保有記帳資料，新用戶會顯示「本月暫無支出記錄」。
-   **自定義分類不見了？** 自定義分類儲存在 `localStorage`，清除瀏覽器資料會遺失。
-   **預算設定無效？** 檢查是否正確儲存，重新設定預算。
-   **圖表顯示異常？** 重新整理頁面，圖表會重新渲染。

## 📥📤 資料管理

### 資料匯出功能
- **一鍵匯出**：點擊首頁右上角設定按鈕 → 匯出資料
- **格式支援**：JSON 格式，包含完整的記帳記錄和元數據
- **檔案命名**：自動以日期命名（例：`記帳資料_2024-01-15.json`）
- **資料完整性**：包含版本資訊、匯出日期、記錄總數等元數據

### 資料匯入功能
- **向後相容**：完全支援舊版資料格式自動轉換
- **格式檢測**：自動識別新版和舊版資料格式
- **資料驗證**：匯入前驗證資料完整性，過濾無效記錄
- **安全確認**：匯入前會提示確認是否覆蓋現有資料
- **錯誤處理**：提供友善的錯誤訊息和處理建議

### 使用方法
1. **匯出資料**：首頁 → 設定按鈕（⚙️）→ 匯出資料
2. **匯入資料**：首頁 → 設定按鈕（⚙️）→ 匯入資料 → 選擇檔案

## 🔄 PWA 更新機制

### 智能版本控制
- **自動檢測**：應用程式會自動檢測新版本的可用性
- **版本管理**：使用語義化版本號（如 v2.0.1）進行版本控制
- **快取策略**：採用多層快取策略確保更新的可靠性

### 更新流程
1. **檢測更新**：當有新版本時，會自動在背景下載
2. **用戶通知**：顯示藍色更新橫幅提示新版本可用
3. **選擇更新**：用戶可選擇「立即更新」或「稍後更新」
4. **自動重載**：更新完成後自動重新載入頁面使用新版本

### 快取管理
- **版本化快取**：每個版本使用獨立的快取空間
- **自動清理**：更新時自動清除舊版本快取
- **智能策略**：
  - **網路優先**：JS/CSS 檔案優先從網路獲取最新版本
  - **快取優先**：圖片等靜態資源優先使用快取
  - **離線支援**：網路不可用時回退到快取版本

### 開發者更新指南
發布新版本時只需：
1. 修改 `public/serviceWorker.js` 中的 `APP_VERSION`
2. 部署應用程式
3. 用戶訪問時會自動檢測並提示更新

```javascript
// 例如：從 v2.0.1 更新到 v2.0.2
const APP_VERSION = '2.0.2'
```

### 解決的問題
- ✅ **PWA 快取問題**：徹底解決已安裝 PWA 無法更新的問題
- ✅ **用戶體驗**：提供友善的更新提示和選擇權
- ✅ **自動管理**：無需手動清除快取或重新安裝
- ✅ **即時生效**：更新後立即使用最新功能
- ✅ **離線相容**：保持離線功能的同時確保及時更新

## 📈 未來規劃

-   雲端同步功能
-   多帳戶支援
-   深色模式
-   多語言支援
-   推送通知
-   更多圖表類型

## 🤝 貢獻

歡迎提交 Issue 和 Pull Request 來改善這個專案！

## 📄 授權

MIT License

---

**輕鬆記帳 2.0** - 讓記帳變得更簡單、更美觀、更智能！